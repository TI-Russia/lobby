# Локальный Запуск

`bundle exec jekyll serve --port 4001 --baseurl ''`

# Локальная разработка Frontend

1. Установить Node.js
2. Выполнить `npm i` для установки зависимостей
3. Выполнить `npm run build` для сборки актуальной версии бандла
4. Выполнить `npm run watch` для запуска отслеживания изменений в js коде и пересборки бандла

# Шэринг конкретной карточки

## Для обновления страниц депутатов необходимо:

1. скачать локально копию сайта
2. настроить среду локальной разработки (npm, jekyll, bundler)
3. положить актуальные json файлы с записями о депутатах:

- (`https://declarator.org/media/dumps/lobbist-small-d7.json`)
- (`https://declarator.org/media/dumps/lobbist-small-d8.json`)
  в директорию `_data`

4. написать имя актуального json файла в \_config.yml в секции page_gen
5. сбилдить сайт -- запустить `jekyll build`
6. скопировать сгенерированные карточки из директории `_site/card` в директорию `person`
7. обновить сайт на сервере

Страницы депутатов генерируются плагином `jekyll _plugins/data_page_generator.rb`
Параметры запуска плагина описаны в `_config.yml`:

```
page_gen:
  - data: 'lobbist-31-07-2019'
    template: 'card'
    name: 'person'
    dir: 'card'
```

Данные о депутатах берутся из файла `_data/lobbist-31-07-2019.json`,
для генерации html страниц используется шаблон `_layouts/card.html`,
для имени страницы используется параметр `person` записи.

```
Пояснения:

Facebook (FB) при парсинге страницы не запускает скрипты, следовательно
мы не могли динамически менять og meta теги страницы для того, чтобы
пользователь мог расшарить конкретную карточку в FB.

Для репоста и шэринга конкретной карточки депутата в FB
используются страницы в каталоге `person`, содержащие правильные og meta теги.
Сами же страницы автоматически редиректят на основную страницу сайта
с последующим открытием карточки этого депутата.

Это сделано для того, чтобы при шэринге указывался заголовок,
содержащий ФИО депутата. ФИО депутата содержится в og meta
тегах его страницы из каталога `person`.
```
